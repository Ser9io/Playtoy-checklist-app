<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
 
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="mobile-web-app-capable" content="yes">
    <link rel="apple-touch-icon" href="icon-192.png">
    <link rel="icon" href="logo.png">

    <title>Checklist Otimizado - Playtoy Park</title>
    <style>
        body { font-family: 'Segoe UI', Arial, sans-serif; padding: 15px; background: #f4f7f6; text-align: center; }
        .header-box { background: white; padding: 15px; border-bottom: 4px solid #1a73e8; margin-bottom: 20px; }
        .container { max-width: 600px; margin: auto; }
        .card { background: white; border: 1px solid #ddd; padding: 18px; margin-bottom: 15px; border-radius: 12px; text-align: left; }
        .thumb-container { position: relative; display: inline-block; margin: 5px; }
        .thumb { width: 90px; height: 90px; object-fit: cover; border-radius: 8px; border: 2px solid #1a73e8; }
        .btn-del { position: absolute; top: -5px; right: -5px; background: red; color: white; border-radius: 50%; width: 20px; height: 20px; border: none; font-size: 12px; cursor: pointer; }
        textarea { width: 100%; height: 70px; border-radius: 8px; border: 1px solid #ccc; padding: 10px; box-sizing: border-box; margin-top: 10px; }
        .btn-save { background: #28a745; color: white; padding: 18px; width: 100%; border: none; border-radius: 12px; font-weight: bold; cursor: pointer; font-size: 16px; margin-top: 20px; }
        .loading-msg { color: #1a73e8; font-weight: bold; display: none; margin-bottom: 10px; }
    </style>
</head>
<body onload="carregarDadosExistentes()">

<div class="header-box">
    <h2 id="txtMaq">---</h2>
    <p>Unidade: <span id="txtLoja">---</span></p>
</div>

<div class="container">
    <div class="card">
        <strong>Tﾃｩcnico Responsﾃ｡vel:</strong>
        <input type="text" id="tecnico" style="width:100%; padding:10px; border-radius:8px; border:1px solid #ccc; box-sizing: border-box;">
    </div>

    <div id="listaPerguntas">
        <div class="card" style="background:#fff3cd;">
            <strong>1. A mﾃ｡quina estﾃ｡ funcionando?</strong><br><br>
            <input type="radio" name="p0" value="Sim"> Sim &nbsp;&nbsp;          
            <input type="radio" name="p0" value="Nﾃ｣o"> Nﾃ｣o
        </div>
    </div>

    <div class="card">
        <strong>萄 Registro Fotogrﾃ｡fico (Fotos Comprimidas)</strong><br><br>
        <p style="font-size: 11px; color: #666;">As fotos sﾃ｣o reduzidas automaticamente para caber mais no sistema.</p>
        <input type="file" id="inputFoto" accept="image/*" capture="camera" multiple onchange="processarFotos(this)">
        <div id="loading" class="loading-msg">Comprimindo imagens... aguarde.</div>
        <div id="galeria" style="margin-top: 10px;"></div> 
        <textarea id="comentarioFoto" placeholder="Detalhes tﾃｩcnicos ou observaﾃｧﾃｵes..."></textarea>
    </div>

    <button class="btn-save" onclick="salvar()">沈 SALVAR CHECKLIST</button>
</div>

<script>
    const params = new URLSearchParams(window.location.search);
    const maquina = params.get("maq") || "";
    const loja = params.get("loja") || "";
 // Cria a data no fuso horﾃ｡rio de Brasﾃｭlia (ou local do dispositivo) formatada como AAAA-MM-DD
    const dataHoje = new Date().toLocaleDateString('sv-SE');   

    document.getElementById("txtMaq").innerText = maquina;
    document.getElementById("txtLoja").innerText = loja;

/* ================= Mﾃ＿UINAS E SEUS CHECKLISTS ================= */

    const checklists = {
	
               /* ================= GRUPO GRUAS ================= */
      
        "Grua Dupla Neo Carnival": ["Existe algum display na mﾃ｡quina falhando?", "A alavanca estﾃ｡ funcionando direito?", "Os botﾃｵes de descer a garra e de movimentar os bichos acendem e estﾃ｣o funcionando?"],
        "Grua Simples Neo Carnival A": ["Existe algum display na mﾃ｡quina falhando?", "A alavanca estﾃ｡ funcionando direito?", "Os botﾃｵes de descer a garra e de movimentar os bichos acendem e estﾃ｣o funcionando?"],
        "Grua Simples Neo Carnival B": ["Existe algum display na mﾃ｡quina falhando?", "A alavanca estﾃ｡ funcionando direito?", "Os botﾃｵes de descer a garra e de movimentar os bichos acendem e estﾃ｣o funcionando?"],
        "Grua Max Claw": ["Existe algum display na mﾃ｡quina falhando?", "A alavanca estﾃ｡ funcionando direito?", "O botﾃ｣o de descer a garra esta funcionando direito?"],
        "Super Bicho Feliz": ["Existe algum display na mﾃ｡quina falhando?", "A alavanca estﾃ｡ funcionando direito?", "O botﾃ｣o de descer a garra esta funcionando direito?"],
        "Grua Top Machine": ["Existe algum display na mﾃ｡quina falhando?", "O botﾃ｣o do jogo estﾃ｡ funcionando direito?"],

               /* ================= GRUPO FLIPERAMA ================= */

        "Multijogos Pandora": ["A imﾃ｡gem da mﾃ｡quina estﾃ｡ boa?", "As alavancas estﾃ｣o funcionando direito?", "Todos os botﾃｵes estﾃ｣o funcionando?", "Existe algum botﾃ｣o falhando?"],

               /* ================= GRUPO KID RIDER ================= */

        "Kid Rider Vs Drago": ["A imﾃ｡gem da mﾃ｡quina estﾃ｡ boa?", "A corrente estﾃ｡ funcionando direito para esquerda e direita e ao puxar durante o jogo?", "A mﾃ｡quina esta balanﾃｧando durante o jogo", "Existe algum ruﾃｭdo ao iniciar o balanﾃｧo do equipamento?"],
        "Kid Rider Nemo": ["A imﾃ｡gem da mﾃ｡quina estﾃ｡ boa?", "O joystick estﾃ｡ funcionando direito?", "O botﾃ｣o estﾃ｡ funcionando?", "A mﾃ｡quina estﾃ｡ balanﾃｧando durante o jogo", "Existe algum ruﾃｭdo ao iniciar o balanﾃｧo do equipamento?"],
        "Kid Rider Trem Azul": ["A imﾃ｡gem da mﾃ｡quina estﾃ｡ boa?", "O volante estﾃ｡ funcionando?", "O pedal estﾃ｡ funcionando", "A mﾃ｡quina estﾃ｡ balanﾃｧando durante o jogo", "Existe algum ruﾃｭdo ao iniciar o balanﾃｧo do equipamento?"],
        "Kid Rider Aviﾃ｣o Apache": ["A imﾃ｡gem da mﾃ｡quina estﾃ｡ boa?", "O equipamento inclina para os lados de acordo com o volante?", "Existe algum ruﾃｭdo ao iniciar o balanﾃｧo do equipamento?"],

               /* ================= GRUPO AIR-GAME ================= */

        "Air Hockey Pac-man A": ["Existe algum display na mﾃ｡quina falhando?", "Existe algum erro no display?", "As portas estﾃ｣o prendendo o disco?", "O disco que se encontra na mﾃ｡quina estﾃ｡ bom e deslizando?", "O fluxo do ar sobre a mesa estﾃ｡ normal?"],
        "Air Hockey Pac-man B": ["Existe algum display na mﾃ｡quina falhando?", "Existe algum erro no display?", "As portas estﾃ｣o prendendo o disco?", "O disco que se encontra na mﾃ｡quina estﾃ｡ bom e deslizando?", "O fluxo do ar sobre a mesa estﾃ｡ normal?"],
        "Air Hockey Pac-man C": ["Existe algum display na mﾃ｡quina falhando?", "Existe algum erro no display?", "As portas estﾃ｣o prendendo o disco?", "O disco que se encontra na mﾃ｡quina estﾃ｡ bom e deslizando?", "O fluxo do ar sobre a mesa estﾃ｡ normal?"],

               /* ================= GRUPO CABINADA ================= */

        "Jurassic Park": ["A imﾃ｡gem da mﾃ｡quina estﾃ｡ boa?", "Os botﾃｵes de start acendem quando tem crﾃｩdito e estﾃ｣o funcionando?", "Os botﾃｵes das armas estﾃ｣o funcionando?", "As armas estﾃ｣o vibrando ao atirar?", "As armas da mﾃ｡quina estﾃ｣o calibradas?"],
        "Transformers": ["A imﾃ｡gem da mﾃ｡quina estﾃ｡ boa?", "Os botﾃｵes de start acendem quando tem crﾃｩdito e estﾃ｣o funcionando?", "Os botﾃｵes das armas estﾃ｣o funcionando?", "As armas estﾃ｣o vibrando ao atirar?", "As armas da mﾃ｡quina estﾃ｣o calibradas?"],

               /* ================= GRUPO SIMULADORES ================= */

        "Super Bikes 2 A": ["A imﾃ｡gem da mﾃ｡quina estﾃ｡ boa?", "Existe algum display na mﾃ｡quina falhando?", "O link da mﾃ｡quina estﾃ｡ ok?", "Os botﾃｵes do painel estﾃ｣o funcionando?", "O banco da moto se encontra inclinada para algum lado?", "As molas estﾃ｣o boas?", "A jogabilidade ao inclinar a moto esta boa no jogo?"],
        "Super Bikes 2 B": ["A imﾃ｡gem da mﾃ｡quina estﾃ｡ boa?", "Existe algum display na mﾃ｡quina falhando?", "O link da mﾃ｡quina esta ok?", "Os botﾃｵes do painel estﾃ｣o funcionando?", "O banco da moto se encontra inclinada para algum lado?", "As molas estﾃ｣o boas?", "A jogabilidade ao inclinar a moto esta boa no jogo?"],
        "Super Speed A": ["A imﾃ｡gem da mﾃ｡quina estﾃ｡ boa?", "O link da mﾃ｡quina estﾃ｡ ok?", "Os botﾃｵes do painel estﾃ｣o funcionando?", "O volante estﾃ｡ respondendo bem no jogo?", "O pedal de freio funciona?", "O pedal de acelerador funciona?", "O acrﾃｭlico vermelho do assoalho estﾃ｡ limpo e aceso", "A marcha estﾃ｡ funcionando?", "A regulagem do banco estﾃ｡ funcionando?", "Simulaﾃｧﾃ｣o estﾃ｡ funcionando?"],
        "Super Speed B": ["A imﾃ｡gem da mﾃ｡quina estﾃ｡ boa?", "O link da mﾃ｡quina estﾃ｡ ok?", "Os botﾃｵes do painel estﾃ｣o funcionando?", "O volante estﾃ｡ respondendo bem no jogo?", "O pedal de freio funciona?", "O pedal de acelerador funciona?", "O acrﾃｭlico vermelho do assoalho estﾃ｡ limpo e aceso", "A marcha estﾃ｡ funcionando?", "A regulagem do banco estﾃ｡ funcionando?", "Simulaﾃｧﾃ｣o estﾃ｡ funcionando?"],
        "Dead Head A": ["A imﾃ｡gem da mﾃ｡quina estﾃ｡ boa?", "O link da mﾃ｡quina estﾃ｡ ok?", "Os botﾃｵes do painel estﾃ｣o funcionando?", "O volante estﾃ｡ respondendo bem no jogo?", "O pedal de freio funciona?", "O pedal de acelerador funciona?", "A regulagem do banco estﾃ｡ funcionando?", "Simulaﾃｧﾃ｣o estﾃ｡ funcionando?"],
        "Dead Head B": ["A imﾃ｡gem da mﾃ｡quina estﾃ｡ boa?", "O link da mﾃ｡quina estﾃ｡ ok?", "Os botﾃｵes do painel estﾃ｣o funcionando?", "O volante estﾃ｡ respondendo bem no jogo?", "O pedal de freio funciona?", "O pedal de acelerador funciona?", "A regulagem do banco estﾃ｡ funcionando?", "Simulaﾃｧﾃ｣o estﾃ｡ funcionando?"],
        "Rilix": ["A imﾃ｡gem da mﾃ｡quina estﾃ｡ boa?", "Os ﾃｳculos estﾃ｣o conectados?", "O efeito de vento estﾃ｡ funcionando?"],

               /* ================= GRUPO REDEMPTIONS ================= */

        "Castle Attack": ["A imﾃ｡gem da mﾃ｡quina estﾃ｡ boa?", "A parte onde fica os tickets e Dispenser estﾃ｡ sujo?", "A trava das bolas estﾃ｡ funcionando?", "Os alvos estﾃ｣o marcando?", "As bolas estﾃ｣o muchas?"],
        "Happy Soccer": ["Existe algum display na mﾃ｡quina falhando?", "A parte onde fica os tickets e dispenser estﾃ｡ sujo?", "Os lanﾃｧadores das bolas estﾃ｣o com forﾃｧa suficiente para fazer o gol?", "As 4 bolas do jogo estﾃ｣o em bom estado?"],
        "Crazy Frog": ["Existe algum display na mﾃ｡quina falhando?", "A parte onde fica os tickets e dispenser estﾃ｡ sujo?", "Os sapinhos estﾃ｣o soltos ou frouxos?", "Os sapinhos estﾃ｣o todos subindos durante o jogo?"],
        "Fun In The Inks": ["A imﾃ｡gem da mﾃ｡quina estﾃ｡ boa?", "A parte onde fica os tickets e dispenser estﾃ｡ sujo?", "A ﾃ｡gua e o filtro estﾃ｣o limpos?", "As armas da mﾃ｡quina estﾃ｣o calibradas?", "As armas estﾃ｣o vibrando ao atirar?", "Os botﾃｵes das armas estﾃ｣o funcionando?", "As armas estﾃ｣o com a saﾃｭda d'ﾃ｡gua com fluxo normal?", "A grama de plﾃ｡stico da mﾃ｡quina esta em bom estado?"],
        "Dinosaur World": ["A imﾃ｡gem da mﾃ｡quina estﾃ｡ boa?", "A parte onde fica os tickets e dispenser estﾃ｡ sujo?", "A ﾃ｡gua e o filtro estﾃ｣o limpos?", "As armas da mﾃ｡quina estﾃ｣o calibradas?", "As armas estﾃ｣o vibrando ao atirar?", "Os botﾃｵes das armas estﾃ｣o funcionando?", "As armas estﾃ｣o com a saﾃｭda d'ﾃ｡gua com fluxo normal?", "A grama de plﾃ｡stico da mﾃ｡quina estﾃ｡ em bom estado?"],
        "Dinosaurs Park": ["A imﾃ｡gem da mﾃ｡quina estﾃ｡ boa?", "A parte onde fica os tickets e dispenser estﾃ｡ sujo?", "As armas da mﾃ｡quina estﾃ｣o calibradas?", "As armas estﾃ｣o vibrando ao atirar?", "Os botﾃｵes das armas estﾃ｣o funcionando?", "O fluxo de saﾃｭda de bolinhas nas armas estﾃ｡ boa?"],
        "Duo Drive": ["A imﾃ｡gem da mﾃ｡quina estﾃ｡ boa?", "A mﾃ｡quina estﾃ｡ com som?", "A parte onde fica os tickets e dispenser estﾃ｡ sujo?", "O volante estﾃ｡ funcionando direito?"],
        "Street Basketball A": ["Existe algum display na mﾃ｡quina falhando?", "A parte onde fica os tickets e dispenser estﾃ｡ sujo?", "A trava das bolas estﾃ｡ funcionando?", "A cesta estﾃ｡ se movimentando no estﾃ｡gio 2? (Precisa fazer 40 pontos no primeiro estﾃ｡gio)", "As bolas estﾃ｣o muchas?"],
        "Street Basketball B": ["Existe algum display na mﾃ｡quina falhando?", "A parte onde fica os tickets e dispenser estﾃ｡ sujo?", "A trava das bolas estﾃ｡ funcionando?", "A cesta estﾃ｡ se movimentando no estﾃ｡gio 2? (Precisa fazer 40 pontos no primeiro estﾃ｡gio)", "As bolas estﾃ｣o muchas?"],
        "Bowling Champ": ["A imﾃ｡gem da mﾃ｡quina estﾃ｡ boa?", "A parte onde fica os tickets e dispenser estﾃ｡ sujo?", "A jogabilidade estﾃ｡ boa?"],
        "Sonic Dash": ["A imﾃ｡gem da mﾃ｡quina estﾃ｡ boa?", "A parte onde fica os tickets e dispenser estﾃ｡ sujo?", "Todos os botﾃｵes estﾃ｣o funcionando?"],
        "Sonho de Mel": ["Existe algum display na mﾃ｡quina falhando?", "A parte onde fica os tickets e dispenser estﾃ｡ sujo?", "Ao iniciar a partida, jﾃ｡ aparece ponto sem ter acertado alguma abelha?", "As abelhas estﾃ｣o marcando ao serem acertadas?", "A trava das bolas estﾃ｡ funcionando?", "O acrﾃｭlico vermelho do display saiu do lugar?"],
        "Duck Splash": ["Existe algum display na mﾃ｡quina falhando?", "A parte onde fica os tickets e dispenser estﾃ｡ sujo?", "A ﾃ｡gua e o filtro estﾃ｣o limpos?", "Tem 4 patinhos em cada lado?", "O fluxo de ﾃ｡gua nas pistolas estﾃ｡ bom?", "Ao jogar de um lado, sai ﾃ｡gua na outra pistola?", "Pistola e grade estﾃ｣o frouxas?"],
        "Astro Invasion": ["Existe algum display na mﾃ｡quina falhando?", "A parte onde fica os tickets e dispenser estﾃ｡ sujo?", "Os bonecos estﾃ｣o marcando pontos ao serem acertados?", "Os bonecos maiores estﾃ｣o subindo e descendo e balanﾃｧando de uma lado para o outro?", "A trava das bolas estﾃ｡ funcionando?", "O alvo de cima esta com o foguete na ponta e girando?", "O alvos de cima estﾃ｣o marcando pontos"],
        "Super Wings": ["A imﾃ｡gem da mﾃ｡quina estﾃ｡ boa?", "A parte onde fica os tickets e dispenser estﾃ｡ sujo?", "Os manches estﾃ｣o funcionado pra direita e para a esquerda e quando ele ﾃｩ puchado?"],
        "MIB": ["A imﾃ｡gem da mﾃ｡quina estﾃ｡ boa?", "A parte onde fica os tickets e dispenser estﾃ｡ sujo?", "As armas da mﾃ｡quina estﾃ｣o calibradas?", "As armas estﾃ｣o vibrando ao atirar?", "Os botﾃｵes das armas estﾃ｣o funcionando?"],
        "Ace Man": ["A imﾃ｡gem da mﾃ｡quina estﾃ｡ boa?", "A parte onde fica os tickets e dispenser estﾃ｡ sujo?", "A ﾃ｡gua e o filtro estﾃ｣o limpos?", "As armas da mﾃ｡quina estﾃ｣o calibradas?", "As armas estﾃ｣o vibrando ao atirar?", "Os botﾃｵes das armas estﾃ｣o funcionando?", "As armas estﾃ｣o com a saﾃｭda d'ﾃ｡gua com fluxo normal?", "A grama de plﾃ｡stico da mﾃ｡quina estﾃ｡ em bom estado?", "O efeito de fumaﾃｧa d'ﾃ｡gua estﾃ｡ funcionando?"],
        "Galaxy Travel": ["Existe algum display na mﾃ｡quina falhando?", "A parte onde fica os tickets e dispenser estﾃ｡ sujo?", "As armas da mﾃ｡quina estﾃ｣o calibradas?", "As armas estﾃ｣o vibrando ao atirar?", "O lazer etﾃ｡ funcinando?", "Os botﾃｵes das armas estﾃ｣o funcionando?", "Todos os bonecos estﾃ｣o funcionando?", "Bonecos estﾃ｣o caindo ao serem acertados?", "A sensibilidade da arma ao acertar os bonecos estﾃ｡ boa?"],
        "Zumbi Land Battle": ["A imﾃ｡gem da mﾃ｡quina estﾃ｡ boa?", "A parte onde fica os tickets e dispenser estﾃ｡ sujo?", "As armas da mﾃ｡quina estﾃ｣o calibradas?", "As armas estﾃ｣o vibrando ao atirar?", "Os botﾃｵes das armas estﾃ｣o funcionando?"],
        "Girafeplay": ["Existe algum display na mﾃ｡quina falhando?", "A parte onde fica os tickets e dispenser estﾃ｡ sujo?", "Todos os dentes estﾃ｣o em pﾃｩ?", "Existe algum dente quebrado?", "Os dentes estﾃ｣o marcando ponto ao serem acertados?", "Existe algum erro no display?"],
        "Drago": ["Existe algum display na mﾃ｡quina falhando?", "A parte onde fica os tickets e dispenser estﾃ｡ sujo?", "A trava das bolas estﾃ｡ funcionando?", "As asas do drago estﾃ｣o funcionando?"],
        "Rainbow": ["O display da mﾃ｡quina estﾃ｡ funcionando com alguma falha ou nﾃ｣o funciona?", "A parte onde fica os tickets e dispenser estﾃ｡ sujo?", "A trava das bolas estﾃ｡ funcionando?", "Ao ligar a mﾃ｡quina e ao levantar a porta, a mﾃ｡quina arma o compressor sem ter bolinhas para subir?", "As bolas estﾃ｣o com dificuldade de subir?", "A mﾃ｡quina estﾃ｡ com algum erro no display, sem ser o erro 6 ou o erro 7?"],
        "Cyclone": ["Existe algum display na mﾃ｡quina falhando?", "A parte onde fica os tickets e dispenser estﾃ｡ sujo?", "Os botﾃｵes estﾃ｣o funcionando?", "Existe alguma lﾃ｢mpada queimada do jogo?", "Os neons estﾃ｣o acendendo direito?"],
        "Pac Man Hammer": ["Existe algum display na mﾃ｡quina falhando?", "A parte onde fica os tickets e dispenser estﾃ｡ sujo?", "Os bonecos estﾃ｣o subindo direito?", "Os bonecos estﾃ｣o marcando ponto ao serem acertados?", "O martelo estﾃ｡ em bom estado e bem preso pela corda?", "Existe algum erro no display da mﾃ｡quina?"],
        "Fright Night": ["Existe algum display na mﾃ｡quina falhando?", "A parte onde fica os tickets e dispenser estﾃ｡ sujo?", "Os bonecos estﾃ｣o subindo direito?", "Os bonecos estﾃ｣o marcando ponto ao serem acertados?", "O martelo estﾃ｡ em bom estado e bem preso pela corda?", "Existe algum erro no display da mﾃ｡quina?"],
        "Super Soldier": ["Existe algum display na mﾃ｡quina falhando?", "A parte onde fica os tickets e dispenser estﾃ｡ sujo?", "Os bonecos estﾃ｣o marcando ponto ao serem acertados?", "O fluxo de bolinhas esta saindo bem na pistola durante o jogo?"],
        "Pirate Hook": ["A imﾃ｡gem da mﾃ｡quina estﾃ｡ boa?", "O display da mﾃ｡quina no.cabeﾃｧote estﾃ｡ ok?", "A parte onde fica os tickets e dispenser estﾃ｡ sujo?", "O botﾃ｣o das manivelas estﾃ｡ funcionado?", "As manivelas estﾃ｣o funcionando?", "As manivelas estﾃ｣o fazendo algum ruido alto ao girar?"]

    };

// 1. Definimos as perguntas padrﾃ｣o que aparecem em TODOS os equipamentos
    const perguntasPadrao = ["Algo frouxo na mﾃ｡quina ou com algum parafuso faltando?", "O cabeﾃｧote estﾃ｡ aceso?", "Existe alguma iluminaﾃｧﾃ｣o na mﾃ｡quina (incluindo led), apagada ou falhando?", "A leitora estﾃ｡ lendo o cartﾃ｣o normalmente?", "O display da leitora estﾃ｡ bom?", "A mﾃ｡quina estﾃ｡ com som?", "A mﾃ｡quina estﾃ｡ limpa?", "Tem algum adesivo danificado na mﾃ｡quina?", "A estﾃｩtica da mﾃ｡quina, em geral, estﾃ｡ boa?", "Existe informativos de como jogar ou de pontuaﾃｧﾃ｣o na mﾃ｡quina?"];

    // 2. Pegamos as perguntas especﾃｭficas da mﾃ｡quina (se existirem)
    const perguntasEspecificas = checklists[maquina] || [];

    // 3. Juntamos as duas: as padrﾃ｣o vﾃｪm PRIMEIRO
    const perguntasExtras = [...perguntasPadrao, ...perguntasEspecificas];

    const container = document.getElementById("listaPerguntas");

    // 4. O loop agora percorre a lista combinada
    perguntasExtras.forEach((p, i) => {
        container.innerHTML += `<div class="card"><strong>${i+2}. ${p}</strong><br><br>
            <input type="radio" name="p${i+1}" value="Sim"> Sim &nbsp;&nbsp;
            <input type="radio" name="p${i+1}" value="Nﾃ｣o"> Nﾃ｣o</div>`;
    });

    let fotosBase64 = [];


function limparRegistrosAntigos() {
    const hist = JSON.parse(localStorage.getItem("historicoChecklist")) || [];
    if (hist.length === 0) return;

    const trintaDiasAtras = new Date();
    trintaDiasAtras.setDate(trintaDiasAtras.getDate() - 30);

    // Filtra para manter apenas registros com menos de 30 dias
    const histFiltrado = hist.filter(reg => {
        const dataReg = new Date(reg.data);
        return dataReg >= trintaDiasAtras;
    });

    // Atualiza o armazenamento se algo foi removido
    if (histFiltrado.length !== hist.length) {
        localStorage.setItem("historicoChecklist", JSON.stringify(histFiltrado));
        console.log("Limpeza de 30 dias concluﾃｭda no checklist.");
    }
}

function carregarDadosExistentes() {
    // Chama a limpeza automﾃ｡tica primeiro
    limparRegistrosAntigos(); 

    const hist = JSON.parse(localStorage.getItem("historicoChecklist")) || [];
    
    // Tenta encontrar o registro especﾃｭfico desta mﾃ｡quina hoje
    const registroMaq = hist.find(r => r.loja === loja && r.equipamento === maquina && r.data === dataHoje);
    
    // Busca o ﾃｺltimo tﾃｩcnico que salvou qualquer checklist hoje para auto-preencher o nome
    const ultimoRegistroDoDia = hist.filter(r => r.data === dataHoje).pop();

    if (registroMaq) {
        document.getElementById("tecnico").value = registroMaq.responsavel;
        document.getElementById("comentarioFoto").value = registroMaq.comentarioFoto;
        registroMaq.itens.forEach((item, i) => {
            const radios = document.getElementsByName(`p${i}`);
            for (let r of radios) { if (r.value === item.resposta) r.checked = true; }
        });
        if (registroMaq.fotos) {
            fotosBase64 = registroMaq.fotos;
            renderizarGaleria();
        }
    } else if (ultimoRegistroDoDia) {
        // Se a mﾃ｡quina nﾃ｣o tem checklist, mas alguﾃｩm jﾃ｡ trabalhou hoje, preenche o nome do tﾃｩcnico
        document.getElementById("tecnico").value = ultimoRegistroDoDia.responsavel;
    }
}



    // --- FUNﾃﾃグ DE COMPRESSﾃグ DE IMAGEM ---
    async function processarFotos(input) {
        const loading = document.getElementById("loading");
        loading.style.display = "block";
        
        const files = Array.from(input.files);
        for (let file of files) {
            const compressed = await compressImage(file);
            fotosBase64.push(compressed);
        }
        
        renderizarGaleria();
        loading.style.display = "none";
        input.value = ""; // Limpa o input para permitir novas fotos
    }

    function compressImage(file) {
        return new Promise((resolve) => {
            const reader = new FileReader();
            reader.readAsDataURL(file);
            reader.onload = (event) => {
                const img = new Image();
                img.src = event.target.result;
                img.onload = () => {
                    const canvas = document.createElement('canvas');
                    const MAX_WIDTH = 800; // Reduz a largura para 800px (ﾃｳtimo para mobile)
                    const scaleSize = MAX_WIDTH / img.width;
                    canvas.width = MAX_WIDTH;
                    canvas.height = img.height * scaleSize;

                    const ctx = canvas.getContext('2d');
                    ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
                    
                    // Comprime a qualidade para 0.7 (70%)
                    const dataUrl = canvas.toDataURL('image/jpeg', 0.7);
                    resolve(dataUrl);
                };
            };
        });
    }

    function renderizarGaleria() {
        const galeria = document.getElementById("galeria");
        galeria.innerHTML = "";
        fotosBase64.forEach((src, index) => {
            const div = document.createElement("div");
            div.className = "thumb-container";
            div.innerHTML = `
                <img src="${src}" class="thumb">
                <button class="btn-del" onclick="removerFoto(${index})">X</button>
            `;
            galeria.appendChild(div);
        });
    }

    function removerFoto(index) {
        fotosBase64.splice(index, 1);
        renderizarGaleria();
    }


function salvar() {
    const tec = document.getElementById("tecnico").value;
    if(!tec) return alert("Preencha o nome do tﾃｩcnico.");

    const todasP = ["Status Geral", ...perguntasExtras];
    const itens = [];

    // VALIDAﾃﾃグ: Verifica se todas as perguntas foram respondidas
    for (let i = 0; i < todasP.length; i++) {
        const rads = document.getElementsByName(`p${i}`);
        let selecionado = null;
        rads.forEach(r => { if(r.checked) selecionado = r.value; });

        if (selecionado === null) {
            return alert(`Por favor, responda a pergunta: ${todasP[i]}`);
        }
        itens.push({ pergunta: todasP[i], resposta: selecionado });
    }

    // CRIAﾃﾃグ DO REGISTO
    const novoRegistro = {
        data: dataHoje, 
        loja: loja, 
        equipamento: maquina, 
        responsavel: tec,
        comentarioFoto: document.getElementById("comentarioFoto").value,
        fotos: fotosBase64,
        itens: itens
    };

    let hist = JSON.parse(localStorage.getItem("historicoChecklist")) || [];
    
    // Remove duplicados do mesmo dia/mﾃ｡quina antes de salvar o novo
    const index = hist.findIndex(r => r.loja === loja && r.equipamento === maquina && r.data === dataHoje);
    if (index !== -1) hist.splice(index, 1);
    
    hist.push(novoRegistro);

    try {
        localStorage.setItem("historicoChecklist", JSON.stringify(hist));
        alert("Checklist atualizado com sucesso!");
        window.location.replace("index.html");
    } catch (e) {
        alert("Erro: O limite de memﾃｳria foi atingido. Remova fotos ou limpe o histﾃｳrico.");
    }
}
</script>
</body>
</html>